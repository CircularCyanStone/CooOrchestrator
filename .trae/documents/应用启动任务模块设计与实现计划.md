## 范围与目标
- 交付可用的启动任务模块 V1，采用 **方案B（Manifest）** 完成自动注册与调度。
- 覆盖：协议/模型、调度器、Manifest 解析、示例任务、DocC 文档、基础单元测试。
- 保证全部在 `MainActor` 同步执行；不引入运行时类型扫描。

## 文件与结构
- `Sources/CooAppStartupTask/StartupTask.swift`：协议与模型（Task/Phase/Priority/Residency/Context/Result）。
- `Sources/CooAppStartupTask/StartupTaskManager.swift`：调度器，集成两个时机（early/late），排序与执行、日志与耗时。
- `Sources/CooAppStartupTask/ManifestDiscovery.swift`：解析 `StartupTasks` 清单（支持模块 Info.plist 与资源 `StartupTasks.plist`）。
- `Sources/CooAppStartupTask/StartupTaskFactory.swift`：工厂协议与默认实现，支持 `args` 注入。
- `Sources/CooAppStartupTask/Logging.swift`：统一 OSLog。
- `Sources/CooAppStartupTask/Examples/{PushNotificationInitTask,ScreenshotTipTask,UpgradePromptTask}.swift`：示例任务。
- `CooAppStartupTask.docc/*`：快速开始与使用说明。
- `Tests/CooAppStartupTaskTests/*`：排序、时机分发、生命周期、异常隔离、清单解析测试。

## 协议与模型（要点）
```swift
@MainActor
public protocol StartupTask: AnyObject {
    static var id: String { get }
    static var phase: StartupTaskPhase { get }
    static var priority: StartupTaskPriority { get }
    static var residency: StartupTaskResidency { get }
    init(context: StartupTaskContext)
    func run() -> StartupTaskResult
}
public enum StartupTaskPhase: Int, CaseIterable { case appLaunchEarly, appLaunchLate }
public struct StartupTaskPriority: RawRepresentable, Comparable { public let rawValue: Int }
public enum StartupTaskResidency { case autoDestroy, resident }
public struct StartupTaskResult { public let success: Bool; public let message: String? }
public struct StartupTaskContext { public let environment: AppEnvironment; public let args: [String: Any] }
public struct AppEnvironment { public let bundle: Bundle }
```

## Manifest 解析
- 支持两来源：
  - 模块 `Info.plist` 的 `StartupTasks: [dict]`。
  - 模块资源包 `StartupTasks.plist`（同结构）。
- 字段：`class`（必填）、`phase`、`priority`、`residency`、`args`（可选字典）。
- 实例化规则：
  - 若存在 `factory` 字段，实例化 `StartupTaskFactory` 并 `make(context:args:)` 返回任务。
  - 否则使用 `init(context:)` 创建；`args` 合入 `StartupTaskContext`。
- 遍历范围：`Bundle.main` 与业务指定/已加载的模块 `Bundle`；仅尝试读取清单文件，未读取类型列表。

## 调度器
- 入口：在宿主 App 的 `didFinishLaunching` 开始与结束各触发一次（由集成方调用两次 API）。
- 流程：汇总对应 `phase` 的任务 → 按 `priority` 降序排序 → `run()` 逐个执行 → 依据 `residency` 决定保留或释放。
- 日志：`OSLog` 记录开始/结束、耗时、结果；失败不中断其他任务。

## 集成示例
- UIKit：`AppDelegate` 中：
  - `StartupTaskManager.shared.fire(.appLaunchEarly)` 在方法开始处。
  - `StartupTaskManager.shared.fire(.appLaunchLate)` 在返回前。
- SwiftUI：在 `App` 初始化与 `onAppear` 中分别触发两个时机。

## 文档与文件头
- 每个源文件头部添加版权与“文件功能描述、类型功能描述”。
- DocC：模块介绍、清单 schema、集成步骤、最佳实践、性能说明。

## 测试
- 构造三个伪任务与两份清单，验证：排序正确、时机分发正确、`resident/autoDestroy` 行为、异常隔离、清单解析健壮性。

## 时间线
1. 落地协议/模型与调度器。
2. 完成 Manifest 解析与工厂机制。
3. 加入示例任务与 DocC 文档。
4. 补齐单元测试并本地验证。

## 后续（下一版）
- 增加 **方案C（宏+插件）**：编译期生成静态注册表，进一步降低运行期开销；与 B 并存。